<!DOCTYPE html>
<html>
<head>
  <title>US State Map - E-Bike Policy</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      color: #142b59;
    }

    #map-wrapper {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 95%;
      margin: 0 auto;
      padding: 10px;
      border: 5px solid #ccc;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      background-color: white;
    }

    .info.legend {
      background: #142b59;
      color: #ffffff;
      padding: 12px 16px;
      font: 16px/20px Arial, sans-serif;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      border-radius: 8px;
      width: auto;
      max-width: 90vw;
    }

    .info.legend i {
      width: 20px;
      height: 20px;
      display: inline-block;
      margin-right: 10px;
      margin-bottom: 5px;
      vertical-align: middle;
      border-radius: 3px;
    }

    @media (max-width: 600px) {
      .info.legend {
        font: 14px/18px Arial, sans-serif;
        padding: 8px 12px;
        max-width: 85vw;
      }
    }

    .leaflet-popup-content a {
      color: #00539b;
      font-weight: bold;
      text-decoration: underline;
    }

    .leaflet-popup-content a:hover {
      color: #ec1f2f;
    }
  </style>
</head>

<body>

<div id="map-wrapper">

  <div style="text-align: center; font-size: 35px; font-weight: bold; margin-bottom: 10px;">
    Micromobility Regulations in United States
  </div>

  <!-- City List Toggle Button -->
  <div style="text-align: center; margin-bottom: 10px;">
    <button id="toggle-city-list" style="
      background-color: #142b59;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    ">
      Show/Hide City List
    </button>
  </div>

  <!-- City List Container -->
  <div id="city-list" style="
    display: none;
    text-align: center;
    margin-bottom: 10px;
    font-family: Arial, sans-serif;
    color: #142b59;
    font-size: 16px;
  ">
  </div>

  <!-- Your dropdowns and logos -->
  <div id="logos" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; padding: 10px 20px;">
    <img src="logo-funder.jpg" alt="Funder Logo" style="height: 80px; width: 200px; object-fit: contain; padding: 5px; box-sizing: border-box;">

    <div style="display: flex; flex-wrap: wrap; justify-content: center; align-items: flex-start; gap: 20px;">
      <div style="border: 2px solid #ccc; border-radius: 10px; padding: 12px 16px; background-color: #fafafa; width: 250px;">
        <label for="mode-select" style="font-size: 16px; font-weight: bold; margin-bottom: 6px; display: block;">Mode</label>
        <select id="mode-select" style="padding: 12px 16px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc; box-shadow: 0 2px 6px rgba(0,0,0,0.1); background-color: #f9f9f9; color: #333; cursor: pointer; width: 100%;">
          <option value="E-bike">E-bike</option>
          <option value="E-scooter">E-scooter</option>
          <option value="Conventional bicycle">Conventional bicycle</option>
          <option value="Moped">Moped</option>
          <option value="Other wheeled modes">Other wheeled modes</option>
        </select>
      </div>

      <div style="border: 2px solid #ccc; border-radius: 10px; padding: 12px 16px; background-color: #fafafa; width: 250px;">
        <label for="variable-select" style="font-size: 16px; font-weight: bold; margin-bottom: 6px; display: block;">Variable</label>
        <select id="variable-select" style="padding: 12px 16px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc; box-shadow: 0 2px 6px rgba(0,0,0,0.1); background-color: #f9f9f9; color: #333; cursor: pointer; width: 100%;">
        </select>
      </div>
    </div>

    <img src="logo-UTK.png" alt="University Logo" style="height: 95px; width: 200px; object-fit: contain; padding: 5px; box-sizing: border-box;">
  </div>

  <div id="map" style="flex-grow: 1; min-height: 60vh;"></div>

  <div id="footer" style="text-align: center; padding: 10px; font-size: 14px; color: #555; line-height: 1.4;">
    <div style="font-weight: bold;">Created by Sameer Aryal at the University of Tennessee, Knoxville</div>
    <div style="font-size: 13px; color: #777; margin-top: 4px;">for Safety of Micromobility: Regulations, Data, and Stakeholders</div>
  </div>

</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script src="us-states.js"></script>

<script>
  // Your existing map logic...
  // Assuming your fetch() block, updateLegend, getColor, getStyle, updateVariableDropdown are already here

  // Now add cities array and toggle logic:

  const cities = [
    { name: 'Atlanta, GA', coords: [33.7490, -84.3880], pdf_url: '#' },
    { name: 'Austin, TX', coords: [30.2672, -97.7431], pdf_url: '#' },
    { name: 'Boston, MA', coords: [42.3601, -71.0589], pdf_url: '#' },
    { name: 'Denver, CO', coords: [39.7392, -104.9903], pdf_url: '#' },
    { name: 'Madison, WI', coords: [43.0731, -89.4012], pdf_url: '#' },
    { name: 'Minneapolis, MN', coords: [44.9778, -93.2650], pdf_url: '#' },
    { name: 'Portland, OR', coords: [45.5051, -122.6750], pdf_url: '#' },
    { name: 'Richmond, VA', coords: [37.5407, -77.4360], pdf_url: '#' },
    { name: 'St. Louis, MO', coords: [38.6270, -90.1994], pdf_url: '#' },
    { name: 'Washington, D.C.', coords: [38.9072, -77.0369], pdf_url: '#' },
    { name: 'New York, NY', coords: [40.7128, -74.0060], pdf_url: '#' },
    { name: 'Philadelphia, PA', coords: [39.9526, -75.1652], pdf_url: '#' },
    { name: 'Tampa, FL', coords: [27.9506, -82.4572], pdf_url: '#' },
    { name: 'Los Angeles, CA', coords: [34.0522, -118.2437], pdf_url: '#' },
    { name: 'Seattle, WA', coords: [47.6062, -122.3321], pdf_url: '#' },
    { name: 'Phoenix, AZ', coords: [33.4484, -112.0740], pdf_url: '#' }
  ];

  // Save city marker references
  const cityMarkers = {};

  // Create markers and store references
  cities.forEach(city => {
    const marker = L.marker(city.coords)
      .addTo(map)
      .bindPopup(`
        <strong>${city.name}</strong><br>
        <a href="${city.pdf_url}" target="_blank" style="
          font-size: 14px;
          color: #1a73e8;
          font-weight: bold;
          text-decoration: underline;
        ">View City Regulation PDF</a>
      `);

    cityMarkers[city.name] = marker;
  });

  // Build city list
  const cityListDiv = document.getElementById('city-list');
  cityListDiv.innerHTML = cities.map(city =>
    `<div style="margin: 5px;">
      <a href="#" onclick="focusCity('${city.name}'); return false;" style="
        color: #00539b;
        text-decoration: underline;
        font-weight: bold;
      ">${city.name}</a>
    </div>`
  ).join('');

  // Toggle button logic
  document.getElementById('toggle-city-list').addEventListener('click', () => {
    const cityList = document.getElementById('city-list');
    cityList.style.display = cityList.style.display === 'none' ? 'block' : 'none';
  });

  // Function to focus on city marker
  function focusCity(cityName) {
    const marker = cityMarkers[cityName];
    if (marker) {
      map.setView(marker.getLatLng(), 8);
      marker.openPopup();
    }
  }
</script>

</body>
</html>
